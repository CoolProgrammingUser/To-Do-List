<!DOCTYPE html>
<html>
    <head>
        <title>
            To-Do List
        </title>
        <script src="https://coolprogramminguser.github.io/Standards/behavior.js"></script>
        <script>
            var items;
            if (localStorage.getItem("To-Do-List")) {
                items = JSON.parse(localStorage.getItem("To-Do-List"));
            } else {
                items = {};
            }
            localStorage.setItem("To-Do-List", JSON.stringify(items));
            var itemNumber = 1;
            var now = new Date();
            var Priority = function(description, date, importance) {
                this.description = description;
                date = date.toLowerCase();
                this.date = date;
                this.importance = importance;
                Priority.instances.push(this);
            }
            Priority.instances = [];
            items.forEach(function(value, key) {
                new Priority(key, value.date, value.importance);
            });
            
            function include() {
                var description = getId("description").value.trim();
                new Priority(description, "1-23-4567", "10");
                items[description] = {"date":"1-23-4567", "importance":"10"};
                localStorage.setItem("To-Do-List", JSON.stringify(items));
                getId("description").value = "";
                createList();
            }
            function createList() {
                getId("list").innerHTML = "";
                Priority.instances.forEach(function(instance) {
                    var input = document.createElement("input");
                    input.type = "checkbox";
                    input.id = "item" + itemNumber;
                    itemNumber++;
                    var label = document.createElement("label");
                    label.for = input.id;
                    label.title = "due: {0}\nimportance: {1}".format(instance.date, instance.importance);
                    label.innerHTML = instance.description;
                    var brs = [document.createElement("br"), document.createElement("br")];
                    getId("list").appendChild(input);
                    getId("list").appendChild(label);
                    getId("list").appendChild(brs[0]);
                    getId("list").appendChild(brs[1]);
                });
            }
            
            window.addEventListener("finished", function() {
                createList();
                getId("remove").addEventListener("click", function() {
                    items.forEach(function(value, key) {
                        if (key == getId("description").value.trim()) {
                            delete items[key];
                            return "break";
                        }
                    });
                    Priority.instances.forEach(function(instance, index) {
                        if (instance.description == getId("description").value.trim()) {
                            Priority.instances.splice(index, 1);
                            return "break";
                        }
                    });
                    localStorage.setItem("To-Do-List", JSON.stringify(items));
                    getId("description").value = "";
                    createList();
                });
            });
        </script>
    </head>
    <body>
        <div id="list" class="list"></div>
        <br>
        <br>
        <input type="text" id="description" placeholder="Thing to do">
        <button onclick="include()">
            Add to list
        </button>
        <button id="remove">
            Remove
        </button>
        <h2>
            Past Due
        </h2>
        <ul id="pastDue"></ul>
    </body>
</html>
