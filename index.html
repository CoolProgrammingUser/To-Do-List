<!DOCTYPE html>
<html>
    <head>
        <title>
            To-Do List
        </title>
        <script src="https://coolprogramminguser.github.io/Standards/behavior.js"></script>
        <script>
            var items;
            if (localStorage.getItem("To-Do-List")) {
                items = JSON.parse(localStorage.getItem("To-Do-List"));
            } else {
                items = {};
            }
            localStorage.setItem("To-Do-List", JSON.stringify(items));
            var itemNumber = 1;
            var now = new Date();
            var Priority = function(description, date, importance) {
                this.date = date.toLowerCase();
                this.importance = importance;
                var checkbox = document.createElement("input");
                checkbox.type = "checkbox";
                checkbox.id = "item" + itemNumber;
                checkbox.style.margin = ".5em";
                itemNumber++;
                var label = document.createElement("label");
                label.for = checkbox.id;
                label.title = "due: {0}\nimportance: {1}".format(this.date, this.importance);
                label.innerHTML = description;
                getId("list").appendChild(checkbox);
                getId("list").appendChild(label);
                getId("list").appendChild(document.createElement("br"));
                checkbox.addEventListener("click", function() {
                    if (checkbox.checked) {
                        label.style.textDecoration = "line-through";
                    } else {
                        label.style.textDecoration = "none";
                    }
                });
                Priority.instances.push(this);
            }
            Priority.instances = [];
            
            function include() {
                var description = getId("description").value.trim();
                new Priority(description, "1-23-4567", "10");
                items[description] = {"date":"1-23-4567", "importance":"10"};
                localStorage.setItem("To-Do-List", JSON.stringify(items));
                getId("description").value = "";
            }
            function refresh() {
                getId("list").innerHTML = "";
                items.forEach(function(value, key) {
                    new Priority(key, value.date, value.importance);
                });
            }
            
            window.addEventListener("finished", function() {
                refresh();
                getId("recurrence").addEventListener("change", function() {
                    switch (this.value) {
                        case "once":
                            getId("monthly").style.display = "none";
                            getId("weekly").style.display = "none";
                            getId("once").style.display = "block";
                            break;
                        case "monthly":
                            getId("once").style.display = "none";
                            getId("weekly").style.display = "none";
                            getId("monthly").style.display = "block";
                            break;
                        case "weekly":
                            getId("once").style.display = "none";
                            getId("monthly").style.display = "none";
                            getId("weekly").style.display = "block";
                            break;
                        case "daily":
                            getId("once").style.display = "none";
                            getId("monthly").style.display = "none";
                            getId("weekly").style.display = "none";
                            break;
                    }
                });
                getId("remove").addEventListener("click", function() {
                    items.forEach(function(value, key) {
                        if (key == getId("description").value.trim()) {
                            delete items[key];
                            return "break";
                        }
                    });
                    Priority.instances.forEach(function(instance, index) {
                        if (instance.description == getId("description").value.trim()) {
                            Priority.instances.splice(index, 1);
                            return "break";
                        }
                    });
                    localStorage.setItem("To-Do-List", JSON.stringify(items));
                    getId("description").value = "";
                    refresh();
                });
            });
        </script>
    </head>
    <body>
        <div id="list" class="list"></div>
        <br>
        <br>
        <input type="text" id="description" placeholder="Thing to do">
        <br>
        <br>
        <select id="importance">
            <option value="" disabled selected>
                Importance
            </option>
            <option value="1">
                1
            </option>
            <option value="2">
                2
            </option>
            <option value="3">
                3
            </option>
            <option value="4">
                4
            </option>
            <option value="5">
                5
            </option>
        </select>
        <note>
            One is least important and five is most important.
        </note>
        <br>
        <br>
        <select id="recurrence">
            <option value="" disabled selected>
                Recurrence
            </option>
            <option value="once">
                One time
            </option>
            <option value="monthly">
                Monthly
            </option>
            <option value="weekly">
                Weekly
            </option>
            <option value="daily" disabled>
                Daily
            </option>
        </select>
        <br>
        <div id="once" style="display:none">
            <br>
            <input type="text" id="fullDate" placeholder="Date (month/day/year)">
            <br>
        </div>
        <div id="monthly" style="display:none">
            <br>
            <input type="text" id="day" placeholder="Day of the month">
            <br>
        </div>
        <div id="weekly" style="display:none">
            <br>
            <input type="checkbox" id="monday">
            <label for="monday">Monday</label>
            <br>
            <input type="checkbox" id="tuesday">
            <label for="tuesday">Tuesday</label>
            <br>
            <input type="checkbox" id="wednesday">
            <label for="wednesday">Wednesday</label>
            <br>
            <input type="checkbox" id="thursday">
            <label for="thursday">Thursday</label>
            <br>
            <input type="checkbox" id="friday">
            <label for="friday">Friday</label>
            <br>
            <input type="checkbox" id="saturday">
            <label for="saturday">Saturday</label>
            <br>
            <input type="checkbox" id="sunday">
            <label for="sunday">Sunday</label>
            <br>
        </div>
        <br>
        <input type="text" id="time" placeholder="Time (hour:minute)">
        &ensp;
        <select id="timeFormat">
            <option value="" disabled selected>
                Time format
            </option>
            <option value="am">
                am
            </option>
            <option value="pm">
                pm
            </option>
            <option value="24-hour">
                24-hour
            </option>
        </select>
        <br>
        <br>
        <button onclick="include()">
            Add to list
        </button>
        <button id="remove">
            Remove
        </button>
        <h2>
            Past Due
        </h2>
        <ul id="pastDue"></ul>
    </body>
</html>
